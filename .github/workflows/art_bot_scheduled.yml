name: Art Bot Scheduled ðŸŽ¨

on:
  schedule:
    # ÐÐ Ð¢: 9:07, 14:07, 19:07, 21:07 ÐœÐ¡Ðš (6:07, 11:07, 16:07, 18:07 UTC)
    - cron: '7 6,11,16,18 * * *'
    # Ð’Ð˜Ð”Ð•Ðž: Ð’Ð¾ÑÐºÑ€ÐµÑÐµÐ½ÑŒÐµ 22:07 ÐœÐ¡Ðš (19:07 UTC)
    - cron: '7 19 * * 0'
  workflow_dispatch:
    inputs:
      mode:
        description: 'Post mode (art or video)'
        required: true
        default: 'art'
        type: choice
        options:
          - art
          - video
      custom_prompt:
        description: 'Custom prompt for image generation (optional)'
        required: false
        default: ''

jobs:
  post_art:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install dependencies
        run: pip install -r requirements.txt

      - name: Runner Time Info
        run: |
          echo "Date: $(date)"
          echo "DOW: $(date +%u) (1-Mon, 7-Sun)"
          echo "Hour: $(date +%H)"

      - name: Run Art Bot
        env:
          BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
          CHANNEL_ID: ${{ secrets.CHANNEL_ID }}
          GOOGLE_KEY: ${{ secrets.GOOGLE_KEY }}
          SILICONFLOW_KEY: ${{ secrets.SILICONFLOW_KEY }}
          RUNWARE_KEY: ${{ secrets.RUNWARE_KEY }}
          KIE_KEY: ${{ secrets.KIE_KEY }}
          HF_KEY: ${{ secrets.HF_KEY }}
          CLOUDFLARE_ID: ${{ secrets.CLOUDFLARE_ID }}
          CLOUDFLARE_TOKEN: ${{ secrets.CLOUDFLARE_TOKEN }}
          GROQ_KEY: ${{ secrets.GROQ_KEY }}
          OPENROUTER_KEY: ${{ secrets.OPENROUTER_KEY }}
          LAOZHANG_KEY: ${{ secrets.LAOZHANG_KEY }}
          YOUR_SIGNATURE: "@fRieNDLee34"
        run: |
          DOW=$(date +%u)
          HOUR=$(date +%H)
          
          # Ð•ÑÐ»Ð¸ ÑÑ‚Ð¾ Ñ€ÑƒÑ‡Ð½Ð¾Ð¹ Ð·Ð°Ð¿ÑƒÑÐº Ð’Ð˜Ð”Ð•Ðž Ð¸Ð»Ð¸ Ð²Ð¾ÑÐºÑ€ÐµÑÐµÐ½ÑŒÐµ 19:00 UTC (22:00 MSK)
          if [ "${{ github.event.inputs.mode }}" == "video" ] || ([ "$DOW" -eq 7 ] && [ "$HOUR" -ge 18 ] && [ "$HOUR" -le 20 ]); then
            echo "ðŸŽ¬ Running Video Generation..."
            python3 -u main.py --video 2>&1 | tee bot_run.log
          elif [ -n "${{ github.event.inputs.custom_prompt }}" ]; then
            echo "ðŸ–Œï¸ Running Art Generation with Custom Prompt..."
            python3 -u main.py --custom-prompt "${{ github.event.inputs.custom_prompt }}" 2>&1 | tee bot_run.log
          else
            echo "ðŸ–Œï¸ Running Art Generation..."
            python3 -u main.py 2>&1 | tee bot_run.log
          fi
