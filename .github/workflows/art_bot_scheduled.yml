name: Art Bot Scheduled ðŸŽ¨

on:
  schedule:
    # ÐÐ Ð¢: 9:07, 14:07, 19:07, 21:07 ÐœÐ¡Ðš (6:07, 11:07, 16:07, 18:07 UTC)
    - cron: '7 6,11,16,18 * * *'
    # Ð’Ð˜Ð”Ð•Ðž: Ð’Ð¾ÑÐºÑ€ÐµÑÐµÐ½ÑŒÐµ 22:07 ÐœÐ¡Ðš (19:07 UTC) â€” Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½Ñ‹Ð¹ Ñ‚Ñ€Ð¸Ð³Ð³ÐµÑ€
    - cron: '7 19 * * 0'
  workflow_dispatch:
    inputs:
      mode:
        description: 'Post mode'
        required: true
        default: 'art'
        type: choice
        options:
          - art
          - video
      custom_prompt:
        description: 'Custom prompt (optional)'
        required: false
        default: ''

jobs:
  post_art:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install dependencies
        run: pip install -r requirements.txt

      - name: Runner Time Info
        run: |
          echo "Date: $(date)"
          echo "DOW: $(date +%u) (1=Mon, 7=Sun)"
          echo "Hour UTC: $(date +%H)"

      - name: Run Art Bot
        env:
          BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
          CHANNEL_ID: ${{ secrets.CHANNEL_ID }}
          GOOGLE_KEY: ${{ secrets.GOOGLE_KEY }}
          SILICONFLOW_KEY: ${{ secrets.SILICONFLOW_KEY }}
          RUNWARE_KEY: ${{ secrets.RUNWARE_KEY }}
          # Ð˜Ð¡ÐŸÐ ÐÐ’Ð›Ð•ÐÐž: KIE_KEY Ð¾Ð±Ð½Ð¾Ð²Ð»Ñ‘Ð½ â€” Ð¾Ð±Ð½Ð¾Ð²Ð¸Ñ‚Ðµ ÑÐµÐºÑ€ÐµÑ‚ Ð² GitHub Settings
          KIE_KEY: ${{ secrets.KIE_KEY }}
          HF_KEY: ${{ secrets.HF_KEY }}
          CLOUDFLARE_ID: ${{ secrets.CLOUDFLARE_ID }}
          CLOUDFLARE_TOKEN: ${{ secrets.CLOUDFLARE_TOKEN }}
          GROQ_KEY: ${{ secrets.GROQ_KEY }}
          OPENROUTER_KEY: ${{ secrets.OPENROUTER_KEY }}
          LAOZHANG_KEY: ${{ secrets.LAOZHANG_KEY }}
          YOUR_SIGNATURE: "@fRieNDLee34"
        run: |
          # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
          # Ð›ÐžÐ“Ð˜ÐšÐ Ð’Ð«Ð‘ÐžÐ Ð Ð Ð•Ð–Ð˜ÐœÐ
          # ÐŸÑ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚: Ñ€ÑƒÑ‡Ð½Ð¾Ð¹ Ð·Ð°Ð¿ÑƒÑÐº > Ð²Ð¾ÑÐºÑ€ÐµÑÐµÐ½ÑŒÐµ 19 UTC > Ð¾Ð±Ñ‹Ñ‡Ð½Ñ‹Ð¹ Ð°Ñ€Ñ‚
          # Python ÐÐ• Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚ Ð²Ñ€ÐµÐ¼Ñ ÑÐ°Ð¼ â€” Ð²ÑÑ‘ Ñ€ÐµÑˆÐ°ÐµÑ‚ÑÑ Ð·Ð´ÐµÑÑŒ
          # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

          DOW=$(date +%u)   # 1=Mon .. 7=Sun
          HOUR=$(date +%H)  # UTC Ñ‡Ð°Ñ

          echo "DOW=$DOW, HOUR=$HOUR, event=${{ github.event_name }}, mode=${{ github.event.inputs.mode }}"

          # 1. Ð ÑƒÑ‡Ð½Ð¾Ð¹ Ð·Ð°Ð¿ÑƒÑÐº Ð² Ñ€ÐµÐ¶Ð¸Ð¼Ðµ video
          if [ "${{ github.event.inputs.mode }}" == "video" ]; then
            echo "ðŸŽ¬ Ð ÑƒÑ‡Ð½Ð¾Ð¹ Ð·Ð°Ð¿ÑƒÑÐº Ð’Ð˜Ð”Ð•Ðž..."
            python3 -u main.py --video 2>&1 | tee bot_run.log

          # 2. ÐšÐ°ÑÑ‚Ð¾Ð¼Ð½Ñ‹Ð¹ Ð¿Ñ€Ð¾Ð¼Ð¿Ñ‚
          elif [ -n "${{ github.event.inputs.custom_prompt }}" ]; then
            echo "ðŸ–Œï¸ ÐšÐ°ÑÑ‚Ð¾Ð¼Ð½Ñ‹Ð¹ Ð¿Ñ€Ð¾Ð¼Ð¿Ñ‚..."
            python3 -u main.py --custom-prompt "${{ github.event.inputs.custom_prompt }}" 2>&1 | tee bot_run.log

          # 3. Ð Ð°ÑÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ Ð²Ð¾ÑÐºÑ€ÐµÑÐµÐ½ÑŒÐµ 19:00 UTC (22:00 ÐœÐ¡Ðš)
          # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼: DOW=7 Ð˜ Ñ‡Ð°Ñ Ð¼ÐµÐ¶Ð´Ñƒ 18 Ð¸ 21 (Ð·Ð°Ð¿Ð°Ñ Ð½Ð° Ð·Ð°Ð´ÐµÑ€Ð¶ÐºÑƒ GitHub Actions Â±1Ñ‡)
          elif [ "$DOW" -eq 7 ] && [ "$HOUR" -ge 18 ] && [ "$HOUR" -le 21 ]; then
            echo "ðŸŽ¬ ÐÐ²Ñ‚Ð¾-Ð²Ð¾ÑÐºÑ€ÐµÑÐµÐ½ÑŒÐµ Ð’Ð˜Ð”Ð•Ðž (DOW=$DOW, HOUR=$HOUR UTC)..."
            python3 -u main.py --video 2>&1 | tee bot_run.log

          # 4. ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ð¹ Ð°Ñ€Ñ‚-Ð¿Ð¾ÑÑ‚
          else
            echo "ðŸ–Œï¸ ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ð¹ Ð°Ñ€Ñ‚-Ð¿Ð¾ÑÑ‚..."
            python3 -u main.py 2>&1 | tee bot_run.log
          fi
